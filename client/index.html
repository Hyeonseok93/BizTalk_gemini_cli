<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Persona Switcher | Chameleon UI</title>
    <link rel="stylesheet" href="css/themes.css">
    <link rel="stylesheet" href="css/animations.css">
    <!-- ê¸°ë³¸ ë° í˜ë¥´ì†Œë‚˜ í°íŠ¸ ë¡œë“œ -->
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.css" />
    <link href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Courier+Prime:wght@400;700&family=Gowun+Batang:wght@400;700&family=Gowun+Dodum&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=Noto+Sans+KR:wght@300;400;700&family=Noto+Serif+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: var(--theme-bg);
            color: var(--theme-text);
            font-family: 'Pretendard', sans-serif;
            transition: background-color 0.5s ease, color 0.5s ease;
            overflow-x: hidden;
            background-size: cover;
            background-attachment: fixed;
        }

        #app {
            display: flex;
            flex-direction: column;
            height: 100vh;
            position: relative;
            z-index: 1;
        }

        /* Mask Selector */
        header {
            height: 120px;
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(15px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 100;
        }

        .mask-container {
            display: flex;
            gap: 15px;
            padding: 10px;
            overflow-x: auto;
            max-width: 95vw;
            scrollbar-width: thin;
            perspective: 1000px; /* 3D íš¨ê³¼ë¥¼ ìœ„í•œ ì›ê·¼ë²• */
        }

        .mask-container::-webkit-scrollbar {
            height: 6px;
        }

        .mask-container::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
        }

        .mask-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            min-width: 80px;
            cursor: pointer;
        }

        .mask-item {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            background: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 22px;
            border: 2px solid transparent;
            transform-style: preserve-3d;
        }

        .mask-name {
            font-size: 0.75rem;
            opacity: 0.8;
            text-align: center;
            white-space: nowrap;
            transition: all 0.3s ease;
        }

        .mask-item.active {
            border-color: var(--portal-blue);
            box-shadow: 0 0 20px var(--portal-blue);
            transform: scale(1.1);
        }

        .mask-item.active + .mask-name {
            opacity: 1;
            font-weight: bold;
            color: var(--portal-blue);
        }

        /* Dual Panel Layout */
        main {
            flex: 1;
            display: flex;
            padding: 30px;
            gap: 30px;
        }

        .panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--panel-bg);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.5s ease;
        }

        .panel-header {
            font-size: 1.1rem;
            margin-bottom: 20px;
            opacity: 0.6;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        textarea {
            width: 100%;
            height: 100%;
            background: transparent;
            border: none;
            color: inherit;
            font-size: 1.15rem;
            resize: none;
            outline: none;
            font-family: inherit;
            line-height: 1.6;
        }

        .output-area {
            font-family: var(--persona-font, inherit);
            font-size: 1.4rem;
            line-height: 1.7;
            white-space: pre-wrap;
            transition: font-family 0.5s ease;
        }

        /* Controls */
        .controls {
            position: absolute;
            bottom: 25px;
            right: 25px;
            display: flex;
            gap: 12px;
        }

        button {
            background: var(--portal-blue);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        button:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .char-counter {
            position: absolute;
            bottom: 25px;
            left: 25px;
            font-size: 0.85rem;
            opacity: 0.4;
        }

        @media (max-width: 768px) {
            main {
                flex-direction: column;
            }
            header {
                height: 100px;
            }
        }

        /* Custom Modal & Toast */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: #1e1e1e;
            padding: 30px;
            border-radius: 15px;
            border: 1px solid var(--portal-blue);
            box-shadow: 0 0 30px rgba(74, 144, 226, 0.3);
            text-align: center;
            max-width: 400px;
            transform: scale(0.8);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .modal-overlay.active .modal-content {
            transform: scale(1);
        }

        .modal-icon {
            font-size: 50px;
            margin-bottom: 20px;
            display: block;
        }

        .modal-title {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: var(--portal-blue);
            font-weight: bold;
        }

        .modal-text {
            line-height: 1.5;
            margin-bottom: 25px;
            opacity: 0.9;
        }

        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--portal-blue);
            color: white;
            padding: 12px 25px;
            border-radius: 50px;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 2000;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .toast.active {
            transform: translateX(-50%) translateY(0);
        }
    </style>
</head>
<body>
    <div id="app">
        <header>
            <div class="mask-container" id="mask-selector">
                <!-- í˜ë¥´ì†Œë‚˜ ë§ˆìŠ¤í¬ ì•„ì´ì½˜ë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
            </div>
        </header>

        <main>
            <!-- Left: Normal Input -->
            <section class="panel" id="input-panel">
                <div class="panel-header">ì¼ìƒì˜ ë‚˜ (Normal)</div>
                <textarea id="user-input" placeholder="ì—¬ê¸°ì— ë³€í™˜í•  ë¬¸ì¥ì„ ì…ë ¥í•˜ì„¸ìš”..." maxlength="500"></textarea>
                <div class="char-counter"><span id="current-chars">0</span>/500</div>
                <div class="controls">
                    <button id="transform-btn">ì°¨ì› ì´ë™ (Transform)</button>
                </div>
            </section>

            <!-- Right: Persona Output -->
            <section class="panel" id="output-panel">
                <div class="panel-header">ë³€ì‹ í•œ ì¸ê²© (Persona)</div>
                <div id="persona-output" class="output-area">ì¸ê²©ì„ ì„ íƒí•˜ê³  ë¬¸ì¥ì„ ì…ë ¥í•˜ë©´ ì´ê³³ì— ê²°ê³¼ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.</div>
                <div class="controls">
                    <button id="copy-btn">ë³µì‚¬</button>
                </div>
            </section>
        </main>
    </div>

    <!-- Custom UI Elements -->
    <div id="modal" class="modal-overlay">
        <div class="modal-content">
            <span class="modal-icon">ğŸŒ€</span>
            <div class="modal-title">ì°¨ì› ì „ì´ ê²½ê³ </div>
            <div class="modal-text" id="modal-message">ë¨¼ì € ìƒë‹¨ì˜ ê°€ë©´ì„ ì„ íƒí•˜ì—¬ ì¸ê²©ì„ ê²°ì •í•´ ì£¼ì„¸ìš”!</div>
            <button id="modal-close-btn">ì‹œìŠ¤í…œ í™•ì¸</button>
        </div>
    </div>
    <div id="toast" class="toast">ë©”ì‹œì§€ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.</div>

    <!-- Scripts -->
    <script src="js/api-client.js"></script>
    <script src="js/theme-engine.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const api = new ApiClient();
            const themeEngine = new ThemeEngine();
            let selectedPersonaId = null;
            
            const maskSelector = document.getElementById('mask-selector');
            const userInput = document.getElementById('user-input');
            const charCounter = document.getElementById('current-chars');
            const personaOutput = document.getElementById('persona-output');
            const transformBtn = document.getElementById('transform-btn');
            
            const modal = document.getElementById('modal');
            const modalMessage = document.getElementById('modal-message');
            const modalCloseBtn = document.getElementById('modal-close-btn');
            const toast = document.getElementById('toast');

            // UI Helper Functions
            const showModal = (msg) => {
                modalMessage.innerText = msg;
                modal.classList.add('active');
            };

            const hideModal = () => {
                modal.classList.remove('active');
            };

            const showToast = (msg) => {
                toast.innerText = msg;
                toast.classList.add('active');
                setTimeout(() => toast.classList.remove('active'), 2500);
            };

            modalCloseBtn.onclick = hideModal;
            modal.onclick = (e) => { if(e.target === modal) hideModal(); };

            // 1. í˜ë¥´ì†Œë‚˜ ëª©ë¡ ë¡œë“œ ë° UI ìƒì„±
            try {
                const personas = await api.getPersonas();
                
                personas.forEach(p => {
                    const wrapper = document.createElement('div');
                    wrapper.className = 'mask-wrapper';
                    
                    const el = document.createElement('div');
                    el.className = 'mask-item';
                    el.innerText = 'ğŸ­'; 
                    el.title = p.description;
                    el.style.backgroundColor = p.color; // ê° í˜ë¥´ì†Œë‚˜ ê³ ìœ ìƒ‰ ì ìš©
                    
                    const name = document.createElement('div');
                    name.className = 'mask-name';
                    name.innerText = p.name;
                    
                    wrapper.onclick = () => {
                        document.querySelectorAll('.mask-item').forEach(m => m.classList.remove('active'));
                        el.classList.add('active');
                        selectedPersonaId = p.id;
                        themeEngine.applyTheme(p);
                        
                        // ì¶œë ¥ íŒ¨ë„ í—¤ë” ì—…ë°ì´íŠ¸ ë° ê¸°ì¡´ ê²°ê³¼ ë¦¬ì…‹
                        document.querySelector('#output-panel .panel-header').innerText = `${p.name} (Persona)`;
                        personaOutput.innerText = 'ë¬¸ì¥ì„ ì…ë ¥í•˜ê³  ì°¨ì› ì´ë™ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.';
                    };
                    
                    wrapper.appendChild(el);
                    wrapper.appendChild(name);
                    maskSelector.appendChild(wrapper);
                });
            } catch (err) {
                personaOutput.innerText = 'ì°¨ì› í†µì‹  ì¥ì• : í˜ë¥´ì†Œë‚˜ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
            }

            // 2. ê¸€ì ìˆ˜ ì¹´ìš´í„°
            userInput.addEventListener('input', () => {
                charCounter.innerText = userInput.value.length;
            });

            // 3. ë³€í™˜ ì‹¤í–‰
            transformBtn.addEventListener('click', async () => {
                const text = userInput.value.trim();
                
                if (!selectedPersonaId) {
                    showModal('ë¨¼ì € ìƒë‹¨ì˜ ê°€ë©´ì„ ì„ íƒí•˜ì—¬ ì¸ê²©ì„ ê²°ì •í•´ ì£¼ì„¸ìš”!');
                    return;
                }
                if (!text) {
                    showModal('ì°¨ì› ì „ì´ë¥¼ ìœ„í•œ ë¬¸ì¥ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
                    return;
                }

                transformBtn.disabled = true;
                transformBtn.innerText = 'ì°¨ì› ì´ë™ ì¤‘...';
                personaOutput.innerText = 'ì¸ê²© ë¹™ì˜ ì¤‘... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì‹­ì‹œì˜¤.';

                try {
                    const result = await api.transformText(selectedPersonaId, text);
                    personaOutput.innerText = result.transformed_text;
                } catch (err) {
                    personaOutput.innerText = `[ì°¨ì› í†µì‹  ì˜¤ë¥˜] ${err.message}`;
                } finally {
                    transformBtn.disabled = false;
                    transformBtn.innerText = 'ì°¨ì› ì´ë™ (Transform)';
                }
            });

            // 4. ë³µì‚¬ ê¸°ëŠ¥
            document.getElementById('copy-btn').addEventListener('click', () => {
                const text = personaOutput.innerText;
                if (!text || text === 'ì¸ê²©ì„ ì„ íƒí•˜ê³  ë¬¸ì¥ì„ ì…ë ¥í•˜ë©´ ì´ê³³ì— ê²°ê³¼ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.') return;
                
                navigator.clipboard.writeText(text).then(() => {
                    showToast('ì¸ê²©ì˜ ì–´íˆ¬ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
                });
            });
        });
    </script>
</body>
</html>
