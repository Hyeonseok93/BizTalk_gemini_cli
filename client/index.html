<!DOCTYPE html>
<html lang="ko" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Persona Switcher | Chameleon UI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/themes.css">
    <link rel="stylesheet" href="css/animations.css">
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.css" />
    <link href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Courier+Prime:wght@400;700&family=Gowun+Batang:wght@400;700&family=Gowun+Dodum&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=Noto+Sans+KR:wght@300;400;700&family=Noto+Serif+KR:wght@400;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        portal: {
                            blue: '#4A90E2',
                        }
                    },
                    fontFamily: {
                        sans: ['Pretendard', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer components {
            .glass-panel {
                @apply bg-white/5 backdrop-blur-xl border border-white/10 rounded-3xl shadow-2xl;
            }
            .persona-btn {
                @apply flex flex-col items-center gap-2 p-3 rounded-2xl transition-all duration-300 hover:bg-white/10 cursor-pointer;
            }
            .persona-icon {
                @apply w-14 h-14 rounded-full flex items-center justify-center text-2xl border-2 border-transparent transition-all duration-300;
            }
            .persona-icon.active {
                @apply border-portal-blue scale-110 shadow-[0_0_20px_rgba(74,144,226,0.5)];
            }
            .action-btn {
                @apply bg-portal-blue hover:bg-portal-blue/80 text-white px-6 py-3 rounded-xl font-bold transition-all duration-300 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-portal-blue/20;
            }
        }
        
        body {
            background-color: var(--theme-bg, #0f172a);
            color: var(--theme-text, #f8fafc);
            background-image: radial-gradient(circle at top right, rgba(74,144,226,0.1), transparent),
                              radial-gradient(circle at bottom left, rgba(74,144,226,0.05), transparent);
            background-attachment: fixed;
        }

        .persona-output-text {
            font-family: var(--persona-font, inherit);
        }
    </style>
</head>
<body class="min-h-screen font-sans transition-colors duration-500">
    <div id="app" class="flex flex-col h-screen">
        <!-- Header / Persona Selector -->
        <header class="h-32 flex items-center justify-center bg-black/40 backdrop-blur-2xl border-b border-white/5 z-50">
            <div class="mask-container flex gap-6 px-6 overflow-x-auto max-w-[95vw] no-scrollbar scroll-smooth py-2" id="mask-selector">
                <!-- Personas injected here -->
            </div>
        </header>

        <main class="flex-1 flex flex-col md:flex-row p-6 md:p-10 gap-8">
            <!-- Left: Input Panel -->
            <section class="flex-1 glass-panel p-8 relative flex flex-col group overflow-hidden">
                <!-- Selection Overlay -->
                <div id="selection-overlay" class="absolute inset-0 z-10 bg-black/60 backdrop-blur-md flex flex-col items-center justify-center text-center p-6 transition-all duration-500">
                    <div class="w-16 h-16 bg-portal-blue/20 rounded-full flex items-center justify-center mb-4 animate-bounce">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-portal-blue" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-2">ì¸ê²© ì„ íƒ í•„ìš”</h3>
                    <p class="text-white/60 text-sm leading-relaxed">ìƒë‹¨ì˜ ê°€ë©´ì„ í´ë¦­í•˜ì—¬<br>ë¹™ì˜í•  ì¸ê²©ì„ ë¨¼ì € ê²°ì •í•´ ì£¼ì„¸ìš”.</p>
                </div>

                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xs uppercase tracking-[0.2em] font-bold text-white/40">ì¼ìƒì˜ ë‚˜ (Normal)</h2>
                    <div class="text-[10px] text-white/20 font-mono"><span id="current-chars">0</span> / 500</div>
                </div>
                <textarea id="user-input" 
                    class="flex-1 bg-transparent border-none text-white text-xl md:text-2xl placeholder:text-white/10 resize-none outline-none leading-relaxed" 
                    placeholder="ì—¬ê¸°ì— ë³€í™˜í•  ë¬¸ì¥ì„ ì…ë ¥í•˜ì„¸ìš”..." 
                    maxlength="500"></textarea>
                <div class="mt-6 flex justify-end">
                    <button id="transform-btn" class="action-btn flex items-center gap-2">
                        <span>ì°¨ì› ì´ë™ (Transform)</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                        </svg>
                    </button>
                </div>
            </section>

            <!-- Right: Output Panel -->
            <section class="flex-1 glass-panel p-8 relative flex flex-col bg-white/[0.02]">
                <div class="flex justify-between items-center mb-6">
                    <h2 id="output-header" class="text-xs uppercase tracking-[0.2em] font-bold text-white/40">ë³€ì‹ í•œ ì¸ê²© (Persona)</h2>
                    <div class="h-2 w-2 rounded-full bg-portal-blue animate-pulse"></div>
                </div>
                <div id="persona-output" class="flex-1 text-white text-2xl md:text-3xl leading-relaxed overflow-y-auto whitespace-pre-wrap persona-output-text">
                    <span class="text-white/20 italic text-xl">ì¸ê²©ì„ ì„ íƒí•˜ê³  ë¬¸ì¥ì„ ì…ë ¥í•˜ë©´ ì´ê³³ì— ê²°ê³¼ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.</span>
                </div>
                <div class="mt-6 flex justify-end">
                    <button id="copy-btn" class="bg-white/10 hover:bg-white/20 text-white px-6 py-3 rounded-xl font-bold transition-all duration-300 flex items-center gap-2 border border-white/5">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" />
                        </svg>
                        <span>ë³µì‚¬</span>
                    </button>
                </div>
            </section>
        </main>
    </div>

    <!-- Modals & Toasts -->
    <div id="modal" class="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm opacity-0 pointer-events-none transition-all duration-300">
        <div class="bg-[#1e1e1e] border border-portal-blue/50 rounded-3xl p-8 max-w-sm w-full text-center shadow-[0_0_50px_rgba(74,144,226,0.2)] transform scale-90 transition-transform duration-300">
            <span class="text-6xl mb-6 block">ğŸŒ€</span>
            <h3 class="text-2xl font-bold text-portal-blue mb-4">ì°¨ì› ì „ì´ ê²½ê³ </h3>
            <p id="modal-message" class="text-white/70 mb-8 leading-relaxed">ë¨¼ì € ìƒë‹¨ì˜ ê°€ë©´ì„ ì„ íƒí•˜ì—¬ ì¸ê²©ì„ ê²°ì •í•´ ì£¼ì„¸ìš”!</p>
            <button id="modal-close-btn" class="w-full action-btn">ì‹œìŠ¤í…œ í™•ì¸</button>
        </div>
    </div>

    <div id="toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 z-[200] bg-portal-blue text-white px-8 py-4 rounded-full font-bold shadow-2xl shadow-portal-blue/40 transform translate-y-24 opacity-0 transition-all duration-500">
        ë©”ì‹œì§€ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.
    </div>

    <script src="js/api-client.js"></script>
    <script src="js/theme-engine.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const api = new ApiClient();
            const themeEngine = new ThemeEngine();
            let selectedPersonaId = null;
            
            const maskSelector = document.getElementById('mask-selector');
            const userInput = document.getElementById('user-input');
            const charCounter = document.getElementById('current-chars');
            const personaOutput = document.getElementById('persona-output');
            const transformBtn = document.getElementById('transform-btn');
            const outputHeader = document.getElementById('output-header');
            
            const modal = document.getElementById('modal');
            const modalMessage = document.getElementById('modal-message');
            const modalCloseBtn = document.getElementById('modal-close-btn');
            const toast = document.getElementById('toast');

            const showModal = (msg) => {
                modalMessage.innerText = msg;
                modal.classList.remove('opacity-0', 'pointer-events-none');
                modal.firstElementChild.classList.remove('scale-90');
            };

            const hideModal = () => {
                modal.classList.add('opacity-0', 'pointer-events-none');
                modal.firstElementChild.classList.add('scale-90');
            };

            const showToast = (msg) => {
                toast.innerText = msg;
                toast.classList.remove('translate-y-24', 'opacity-0');
                setTimeout(() => toast.classList.add('translate-y-24', 'opacity-0'), 2500);
            };

            modalCloseBtn.onclick = hideModal;
            modal.onclick = (e) => { if(e.target === modal) hideModal(); };

            try {
                const personas = await api.getPersonas();
                personas.forEach(p => {
                    const wrapper = document.createElement('div');
                    wrapper.className = 'persona-btn';
                    
                    const icon = document.createElement('div');
                    icon.className = 'persona-icon';
                    icon.innerText = 'ğŸ­';
                    icon.style.backgroundColor = p.color;
                    icon.title = p.description;
                    
                    const name = document.createElement('div');
                    name.className = 'text-[10px] font-bold text-white/40 uppercase tracking-widest transition-colors';
                    name.innerText = p.name;
                    
                    wrapper.onclick = () => {
                        // ì˜¤ë²„ë ˆì´ ìˆ¨ê¸°ê¸°
                        const overlay = document.getElementById('selection-overlay');
                        if (overlay) {
                            overlay.classList.add('opacity-0', 'pointer-events-none');
                            setTimeout(() => overlay.remove(), 500);
                        }

                        // ëª¨ë“  ì•„ì´ì½˜ì—ì„œ active í´ë˜ìŠ¤ ì œê±° (ì• ë‹ˆë©”ì´ì…˜ ì´ˆê¸°í™”)
                        document.querySelectorAll('.persona-icon').forEach(m => {
                            m.classList.remove('active');
                            // ê°•ì œ ë¦¬í”Œë¡œìš°ë¡œ ì• ë‹ˆë©”ì´ì…˜ ì¬ì‹œì‘ ì¤€ë¹„
                            void m.offsetWidth;
                        });
                        document.querySelectorAll('.persona-btn div:last-child').forEach(n => n.classList.replace('text-portal-blue', 'text-white/40'));
                        
                        // í˜„ì¬ í´ë¦­í•œ ì•„ì´ì½˜ì— active í´ë˜ìŠ¤ ì¶”ê°€
                        icon.classList.add('active');
                        name.classList.replace('text-white/40', 'text-portal-blue');
                        
                        selectedPersonaId = p.id;
                        themeEngine.applyTheme(p);
                        
                        outputHeader.innerText = `${p.name} (Persona)`;
                        personaOutput.innerHTML = '<span class="text-white/20 italic text-xl">ë¬¸ì¥ì„ ì…ë ¥í•˜ê³  ì°¨ì› ì´ë™ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</span>';
                    };
                    
                    wrapper.appendChild(icon);
                    wrapper.appendChild(name);
                    maskSelector.appendChild(wrapper);
                });
            } catch (err) {
                personaOutput.innerText = 'ì°¨ì› í†µì‹  ì¥ì• : í˜ë¥´ì†Œë‚˜ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
            }

            userInput.addEventListener('input', () => {
                charCounter.innerText = userInput.value.length;
            });

            transformBtn.addEventListener('click', async () => {
                const text = userInput.value.trim();
                
                if (!selectedPersonaId) {
                    showModal('ë¨¼ì € ìƒë‹¨ì˜ ê°€ë©´ì„ ì„ íƒí•˜ì—¬ ì¸ê²©ì„ ê²°ì •í•´ ì£¼ì„¸ìš”!');
                    return;
                }
                if (!text) {
                    showModal('ì°¨ì› ì „ì´ë¥¼ ìœ„í•œ ë¬¸ì¥ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.');
                    return;
                }

                transformBtn.disabled = true;
                const originalBtnText = transformBtn.innerHTML;
                transformBtn.innerHTML = '<span>ì°¨ì› ì´ë™ ì¤‘...</span><div class="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"></div>';
                personaOutput.innerHTML = '<div class="flex flex-col items-center justify-center h-full gap-4 text-white/40"><div class="w-12 h-12 border-4 border-white/5 border-t-portal-blue rounded-full animate-spin"></div><div class="animate-pulse">ì¸ê²© ë¹™ì˜ ì¤‘... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì‹­ì‹œì˜¤.</div></div>';

                try {
                    const result = await api.transformText(selectedPersonaId, text);
                    personaOutput.innerText = result.transformed_text;
                } catch (err) {
                    personaOutput.innerHTML = `<span class="text-red-400 font-mono text-lg">[ì°¨ì› í†µì‹  ì˜¤ë¥˜] ${err.message}</span>`;
                } finally {
                    transformBtn.disabled = false;
                    transformBtn.innerHTML = originalBtnText;
                }
            });

            document.getElementById('copy-btn').addEventListener('click', () => {
                const text = personaOutput.innerText;
                if (!text || personaOutput.querySelector('span')) return;
                
                navigator.clipboard.writeText(text).then(() => {
                    showToast('ì¸ê²©ì˜ ì–´íˆ¬ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
                });
            });
        });
    </script>
</body>
</html>
